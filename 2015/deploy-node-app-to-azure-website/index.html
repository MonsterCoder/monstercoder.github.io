<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>Troubleshoot your node.js app deployment on Azure website | Awakening Byte</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Deploying Node applications to Azure website seems simple. Just set up continuous deployment on the Azure Portal. Azure will build, test and automatically depoly your app when you check in code. Every">
<meta property="og:type" content="article">
<meta property="og:title" content="Troubleshoot your node.js app deployment on Azure website">
<meta property="og:url" content="http://monstercoder.github.io/2015/deploy-node-app-to-azure-website/index.html">
<meta property="og:site_name" content="Awakening Byte">
<meta property="og:description" content="Deploying Node applications to Azure website seems simple. Just set up continuous deployment on the Azure Portal. Azure will build, test and automatically depoly your app when you check in code. Every">
<meta property="og:updated_time" content="2016-03-14T03:09:31.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Troubleshoot your node.js app deployment on Azure website">
<meta name="twitter:description" content="Deploying Node applications to Azure website seems simple. Just set up continuous deployment on the Azure Portal. Azure will build, test and automatically depoly your app when you check in code. Every">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="https://d3jce08r7vf3n5.cloudfront.net/pulse/clear-measure/images/users/63264/1455063116270_DSC_0026.jpg?width=165&amp;height=250" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">George Chen</a></h1>
		</hgroup>

		
		<p class="header-subtitle">An awakening byte on the  journey</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>Menu</li>
						<li>Tags</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">Main</a></li>
				        
							<li><a href="/archives">All</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/monstercoder" title="github">github</a>
					        
								<a class="twitter" target="_blank" href="https://twitter.com/GeorgeC_monster" title="twitter">twitter</a>
					        
								<a class="linkedin" target="_blank" href="https://www.linkedin.com/in/awakeningbyte" title="linkedin">linkedin</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/NET-Core/" style="font-size: 10px;">.NET Core</a> <a href="/tags/Azure/" style="font-size: 10px;">Azure</a> <a href="/tags/C/" style="font-size: 16.67px;">C#</a> <a href="/tags/F/" style="font-size: 10px;">F#</a> <a href="/tags/Node-js/" style="font-size: 20px;">Node.js</a> <a href="/tags/architecture/" style="font-size: 16.67px;">architecture</a> <a href="/tags/docker/" style="font-size: 20px;">docker</a> <a href="/tags/microservice/" style="font-size: 16.67px;">microservice</a> <a href="/tags/project-euler/" style="font-size: 13.33px;">project-euler</a>
					</div>
				</section>
				
				
				

				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">George Chen</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="https://d3jce08r7vf3n5.cloudfront.net/pulse/clear-measure/images/users/63264/1455063116270_DSC_0026.jpg?width=165&amp;height=250" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">George Chen</h1>
			</hgroup>
			
			<p class="header-subtitle">An awakening byte on the  journey</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">Main</a></li>
		        
					<li><a href="/archives">All</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/monstercoder" title="github">github</a>
			        
						<a class="twitter" target="_blank" href="https://twitter.com/GeorgeC_monster" title="twitter">twitter</a>
			        
						<a class="linkedin" target="_blank" href="https://www.linkedin.com/in/awakeningbyte" title="linkedin">linkedin</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap"><article id="post-deploy-node-app-to-azure-website" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/deploy-node-app-to-azure-website/" class="article-date">
  	<time datetime="2015-12-22T05:33:02.000Z" itemprop="datePublished">2015-12-21</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Troubleshoot your node.js app deployment on Azure website
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Azure/">Azure</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Node-js/">Node.js</a></li></ul>
	</div>

        

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Deploying Node applications to Azure website seems simple. Just set up continuous deployment on the Azure Portal. Azure will build, test and automatically depoly your app when you check in code. Everything runs so well until you open a browser, navigate to the webisite url and see this: 500 internal server error. That was exactly the case we had in last project. The application was written in node &amp; express with dependancies to 52 npm packages including babel, redis, new relic, gulp, webpack. It works like a charm on local servers, just not on Azure website with git deployment. As usual, most documentation we found online are about “Hello world” which won’t help much with a production problem. Here are some of the steps we used to diagnose and analysis the deploy problem and make it work.</p>
<h2 id="Test-compilation-on-windows"><a href="#Test-compilation-on-windows" class="headerlink" title="Test compilation on windows"></a>Test compilation on windows</h2><p>During npm install, some node modules with native extensions will be compiled to match the hosting OS and architecture(x86 or x64). If the application is developed on Mac OS, Linux and deploy to Azure website, first thing to do is to confirm that every module is compatible with windows platfom. </p>
<p>##web.config file<br>Under the hood, Azure website hosts node.js apps with iisnode. You need a web.config to config iisnode. If you use git deployment, when Azure detects an app.js or server.js file, it will automatically generate a web.config. Or you can add a custom one manually. Open the web.config file, and check the handlers section. Make sure it points to the correct application entry point.</p>
<pre><code>&lt;handlers&gt;
    &lt;add name=&quot;iisnode&quot; path=&quot;app.js&quot; verb=&quot;*&quot; modules=&quot;iisnode&quot;/&gt;
&lt;/handlers&gt;
</code></pre><h2 id="Enviroment-variables"><a href="#Enviroment-variables" class="headerlink" title="Enviroment variables"></a>Enviroment variables</h2><p>You can set enviroment variables through website portal or Azure CLI. The easiest way to check their value is through website portal, under <strong>config</strong> section, choose app settings. Or if you are using Azure CLI, run</p>
<pre><code>azure site config list your-site
</code></pre><p>Make sure there is no PORT setting. iisnode will use this variable to pipe IIS to your app.<br>Also check value of WEBSITE_NODE_DEFAULT_VERSION, it sets default node version used by the target website.</p>
<h2 id="Check-in-node-modules"><a href="#Check-in-node-modules" class="headerlink" title="Check in node_modules"></a>Check in node_modules</h2><p>When using git deployment, normally we don’t check in node_modules. However, according to this Azure documentation</p>
<blockquote>
<p>Azure Websites does not support all native modules and might fail at compiling those with very specific prerequisites. </p>
</blockquote>
<p>So if all the about steps don’t help, you might want to test it out by checking in you node_modules. Remember, before checkin, run npm install on a windows platform with some architecture of you website.</p>
<h2 id="Enable-Application-log"><a href="#Enable-Application-log" class="headerlink" title="Enable Application log"></a>Enable Application log</h2><p>Add the following to your iisnode.yml</p>
<pre><code>node_env: production
loggingEnabled: true
devErrorsEnabled: true
</code></pre><p>Then you can use Azure CLI to live stream the logs</p>
<pre><code>$ azure site log tail sampleBlog
</code></pre><h2 id="Debug-with-Kudu"><a href="#Debug-with-Kudu" class="headerlink" title="Debug with Kudu"></a>Debug with Kudu</h2><p><a href="https://github.com/" target="_blank" rel="external">Kudu</a> is the engine behind git deployments in Azure Web Sites.<br>Every Azure web site has an associated ‘scm’ service site at <a href="https://your-site.scm.azurewebsites.net/" target="_blank" rel="external">https://your-site.scm.azurewebsites.net/</a>. It provides a set of tools for troubleshooting and analysis your node.js website. You can:</p>
<ul>
<li>Launch the <a href="https://github.com/projectkudu/kudu/wiki/Kudu-console" target="_blank" rel="external">diagnostic console</a></li>
<li>Check runtime environment</li>
<li>Monitor active node process</li>
</ul>
<p>Open the debug console, choose CMD or powershell.<br>Then start you app with node.exe directly</p>
<pre><code>$ cd D:\home\site\wwwroot&gt; 
$ node app.js
</code></pre><p>If you see an error from a node module, it might be caused by either wrong node version or corrupt node_module.  Check the current node version </p>
<pre><code>$ node -v
</code></pre><p>make sure it is your target version. Run npm install for the failed module if necessary. Once the app starts from console, you can close it and restart your website. Open a browser and see your website start working.</p>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/project-euler-54/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          Project Euler - Poker Hands (1) - C# solution
        
      </div>
    </a>
  
  
    <a href="/2015/1/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">Build a backend with Node.js, container and Azure (1)</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>


<div class="share_jia">

</div>






<div class="duoshuo">

</div>




</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 George Chen
    	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>